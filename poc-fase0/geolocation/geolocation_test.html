<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POC 2: Valida√ß√£o de Geolocaliza√ß√£o HTML5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .criteria {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .criteria h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .criteria ul {
            margin-left: 20px;
            color: #555;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 25px;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 5px;
        }

        .result-item .label {
            font-weight: bold;
            color: #555;
        }

        .result-item .value {
            color: #333;
        }

        .status {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .test-history {
            margin-top: 25px;
        }

        .test-history h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .history-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .accuracy-meter {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .accuracy-bar {
            height: 100%;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 50%, #4caf50 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #2196f3;
        }

        .info h4 {
            color: #1976d2;
            margin-bottom: 8px;
        }

        .info p {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç POC 2: Valida√ß√£o de Geolocaliza√ß√£o HTML5</h1>
        <p class="subtitle">Teste de precis√£o de GPS para sistema de ponto eletr√¥nico</p>

        <div class="criteria">
            <h3>üìä Crit√©rios de Sucesso</h3>
            <ul>
                <li><strong>Outdoor:</strong> Precis√£o < 50m em 80% dos testes</li>
                <li><strong>Indoor:</strong> Documentar limita√ß√µes</li>
                <li><strong>Tempo de resposta:</strong> < 10 segundos</li>
                <li><strong>Taxa de sucesso:</strong> > 90%</li>
            </ul>
        </div>

        <button class="btn" id="testBtn" onclick="runGeolocationTest()">
            üéØ Capturar Localiza√ß√£o
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Obtendo localiza√ß√£o precisa...</p>
            <small>Isso pode levar alguns segundos</small>
        </div>

        <div class="results" id="results">
            <div class="result-card">
                <h3>üìç Coordenadas Obtidas</h3>
                <div class="result-item">
                    <span class="label">Latitude:</span>
                    <span class="value" id="latitude">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Longitude:</span>
                    <span class="value" id="longitude">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Precis√£o:</span>
                    <span class="value" id="accuracy">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Altitude:</span>
                    <span class="value" id="altitude">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Timestamp:</span>
                    <span class="value" id="timestamp">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Tempo de resposta:</span>
                    <span class="value" id="responseTime">-</span>
                </div>
            </div>

            <div class="result-card">
                <h3>üìè An√°lise de Precis√£o</h3>
                <div class="accuracy-meter">
                    <div class="accuracy-bar" id="accuracyBar" style="width: 0%">
                        <span id="accuracyLabel">-</span>
                    </div>
                </div>
                <div id="accuracyAnalysis"></div>
            </div>

            <div class="status" id="status"></div>
        </div>

        <div class="test-history" id="historySection" style="display: none;">
            <h3>üìú Hist√≥rico de Testes</h3>
            <div id="history"></div>
        </div>

        <div class="info">
            <h4>‚ÑπÔ∏è Instru√ß√µes para Teste Completo</h4>
            <p>
                <strong>Cen√°rio 1 - Outdoor (c√©u aberto):</strong> Teste em √°rea externa sem obstru√ß√µes.<br>
                <strong>Cen√°rio 2 - Indoor (escrit√≥rio):</strong> Teste dentro do ambiente de trabalho.<br>
                <strong>Cen√°rio 3 - Dispositivos diferentes:</strong> Teste em desktop e mobile.
            </p>
        </div>
    </div>

    <script>
        let testHistory = [];

        function runGeolocationTest() {
            if (!navigator.geolocation) {
                alert('‚ùå Geolocaliza√ß√£o n√£o suportada pelo navegador!');
                return;
            }

            // UI updates
            document.getElementById('testBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            const startTime = Date.now();

            const options = {
                enableHighAccuracy: true,
                timeout: 30000,
                maximumAge: 0
            };

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;

                    displayResults(position, responseTime, 'success');
                    saveToHistory(position, responseTime, 'success');
                },
                (error) => {
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;

                    displayError(error, responseTime);
                    saveToHistory(null, responseTime, 'error', error.message);
                },
                options
            );
        }

        function displayResults(position, responseTime, status) {
            const coords = position.coords;

            // Update coordinates
            document.getElementById('latitude').textContent = coords.latitude.toFixed(6);
            document.getElementById('longitude').textContent = coords.longitude.toFixed(6);
            document.getElementById('accuracy').textContent = `${coords.accuracy.toFixed(2)} metros`;
            document.getElementById('altitude').textContent = coords.altitude !== null
                ? `${coords.altitude.toFixed(2)} m`
                : 'N√£o dispon√≠vel';
            document.getElementById('timestamp').textContent = new Date(position.timestamp).toLocaleString('pt-BR');
            document.getElementById('responseTime').textContent = `${(responseTime / 1000).toFixed(2)} segundos`;

            // Analyze accuracy
            analyzeAccuracy(coords.accuracy, responseTime);

            // Show results
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.getElementById('testBtn').disabled = false;
        }

        function analyzeAccuracy(accuracy, responseTime) {
            let qualityPercent = 0;
            let qualityText = '';
            let statusClass = '';
            let statusMessage = '';

            // Calculate quality percentage (inverse of accuracy - better accuracy = higher %)
            if (accuracy <= 10) {
                qualityPercent = 100;
                qualityText = 'Excelente';
                statusClass = 'success';
                statusMessage = '‚úÖ POC PASSOU - Precis√£o excelente para sistema de ponto eletr√¥nico!';
            } else if (accuracy <= 50) {
                qualityPercent = 80;
                qualityText = 'Boa';
                statusClass = 'success';
                statusMessage = '‚úÖ POC PASSOU - Precis√£o adequada para geofencing!';
            } else if (accuracy <= 100) {
                qualityPercent = 50;
                qualityText = 'Aceit√°vel';
                statusClass = 'warning';
                statusMessage = '‚ö†Ô∏è ATEN√á√ÉO - Precis√£o no limite aceit√°vel. Considerar WiFi positioning.';
            } else {
                qualityPercent = 20;
                qualityText = 'Baixa';
                statusClass = 'error';
                statusMessage = '‚ùå POC FALHOU - Precis√£o insuficiente. Implementar fallback obrigat√≥rio.';
            }

            // Update accuracy meter
            document.getElementById('accuracyBar').style.width = qualityPercent + '%';
            document.getElementById('accuracyLabel').textContent = qualityText;

            // Update accuracy analysis
            const analysisHTML = `
                <div class="result-item">
                    <span class="label">Qualidade:</span>
                    <span class="value">${qualityText} (${qualityPercent}%)</span>
                </div>
                <div class="result-item">
                    <span class="label">Crit√©rio (< 50m):</span>
                    <span class="value">${accuracy < 50 ? '‚úÖ Atendido' : '‚ùå N√£o atendido'}</span>
                </div>
                <div class="result-item">
                    <span class="label">Tempo (< 10s):</span>
                    <span class="value">${responseTime/1000 < 10 ? '‚úÖ Atendido' : '‚ùå N√£o atendido'}</span>
                </div>
            `;
            document.getElementById('accuracyAnalysis').innerHTML = analysisHTML;

            // Update status
            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status ' + statusClass;
            statusDiv.textContent = statusMessage;
        }

        function displayError(error, responseTime) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.getElementById('testBtn').disabled = false;

            let errorMessage = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = '‚ùå Permiss√£o negada pelo usu√°rio';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = '‚ùå Informa√ß√£o de localiza√ß√£o indispon√≠vel';
                    break;
                case error.TIMEOUT:
                    errorMessage = '‚ùå Timeout ao obter localiza√ß√£o';
                    break;
                default:
                    errorMessage = '‚ùå Erro desconhecido ao obter localiza√ß√£o';
            }

            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status error';
            statusDiv.textContent = `${errorMessage}\n\nDetalhes: ${error.message}`;
        }

        function saveToHistory(position, responseTime, status, errorMsg = null) {
            const historyItem = {
                timestamp: new Date().toLocaleString('pt-BR'),
                status: status,
                responseTime: (responseTime / 1000).toFixed(2),
                accuracy: position ? position.coords.accuracy.toFixed(2) : 'N/A',
                error: errorMsg
            };

            testHistory.unshift(historyItem);

            // Keep last 10 tests
            if (testHistory.length > 10) {
                testHistory = testHistory.slice(0, 10);
            }

            displayHistory();
        }

        function displayHistory() {
            const historySection = document.getElementById('historySection');
            const historyDiv = document.getElementById('history');

            if (testHistory.length === 0) {
                historySection.style.display = 'none';
                return;
            }

            historySection.style.display = 'block';

            const successCount = testHistory.filter(t => t.status === 'success').length;
            const successRate = ((successCount / testHistory.length) * 100).toFixed(1);

            let historyHTML = `<div class="history-item" style="background: #e3f2fd; font-weight: bold;">
                Taxa de Sucesso: ${successCount}/${testHistory.length} (${successRate}%) -
                Crit√©rio: > 90%
            </div>`;

            testHistory.forEach((item, index) => {
                const statusIcon = item.status === 'success' ? '‚úÖ' : '‚ùå';
                historyHTML += `
                    <div class="history-item">
                        <strong>#${index + 1}</strong> ${statusIcon}
                        ${item.timestamp} -
                        Precis√£o: ${item.accuracy}m -
                        Tempo: ${item.responseTime}s
                        ${item.error ? `<br><small>Erro: ${item.error}</small>` : ''}
                    </div>
                `;
            });

            historyDiv.innerHTML = historyHTML;
        }

        // Display instructions on load
        window.onload = () => {
            console.log('POC 2: Geolocaliza√ß√£o HTML5 carregado');
            console.log('Aguardando comando do usu√°rio para testar geolocaliza√ß√£o...');
        };
    </script>
</body>
</html>
